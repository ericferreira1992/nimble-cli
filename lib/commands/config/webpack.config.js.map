{"version":3,"file":"webpack.config.js","sourceRoot":"","sources":["../../../src/commands/config/webpack.config.ts"],"names":[],"mappings":"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","sourcesContent":["import path from 'path';\nimport webpack from 'webpack';\nimport chalk from 'chalk';\n// import * as BaseHref from 'base-href-webpack-plugin';\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\nimport CopyPlugin from 'copy-webpack-plugin';\nimport PrerenderSpaPlugin from 'prerender-spa-plugin';\nimport MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport { CleanWebpackPlugin } from 'clean-webpack-plugin';\nimport CompressionPlugin from 'compression-webpack-plugin';\n\nlet configuration: {\n\t'pre-render': {\n\t\tenabled: boolean,\n\t\troutes: string[]\n\t},\n\tbaseHref: string,\n\tvendors: { js: string[], css: string[] }\n} = {} as any;\n\ntry { configuration = require(process.cwd() + '/nimble.json'); }\ncatch { configuration = {} as any; }\n\nconst Renderer = PrerenderSpaPlugin.PuppeteerRenderer;\n// const BaseHrefWebpackPlugin = BaseHref.BaseHrefWebpackPlugin;\n\nconst distPath = path.resolve(process.cwd(), 'build');\n\nlet options: { baseHref?: string, gziped?: boolean } = {} as any;\n\nexport async function webpackConfig(env: string, opts: { baseHref?: string, gziped?: boolean }, inBuilding: boolean = false) {\n\toptions = opts;\n\tlet config = {\n\t\tmode: inBuilding ? 'production' : 'development',\n\t\tentry: getEntries(),\n\t\toutput: {\n\t\t\tchunkFilename: '[name].bundle.[chunkhash].js',\n\t\t\tsourceMapFilename: '[name].bundle.[chunkhash].map',\n\t\t\tfilename: '[name].bundle.[chunkhash].js',\n\t\t\tpath: distPath,\n\t\t\tpublicPath: ''\n\t\t},\n\t\twatch: !inBuilding,\n\t\twatchOptions: { ignored: [`${process.cwd()}/node_modules`] },\n\t\tplugins: await getPlugins(inBuilding, env),\n\t\tmodule: {\n\t\t\trules: getRules(inBuilding)\n\t\t},\n\t\tresolve: {\n\t\t\textensions: ['.ts', '.js', '.scss'],\n\t\t\talias: (() => {\n\t\t\t\tconst tsconfigPath = process.cwd() + '/tsconfig.json';\n\t\t\t\tconst { baseUrl, paths } = require(tsconfigPath).compilerOptions;\n\t\t\t\tconst pathPrefix = path.resolve(path.dirname(tsconfigPath), baseUrl);\n\t\t\t\tconst aliases = {} as any;\n\n\t\t\t\tObject.keys(paths).forEach((item) => {\n\t\t\t\t\tconst name = item.replace('/*', '');\n\t\t\t\t\tconst value = path.resolve(pathPrefix, paths[item][0].replace('/*', ''));\n\n\t\t\t\t\taliases[name] = value;\n\t\t\t\t});\n\n\t\t\t\treturn aliases;\n\t\t\t})(),\n\t\t\tfallback: {\n\t\t\t  util: require.resolve('util/'),\n\t\t\t}\n\t\t},\n\t\toptimization: {\n\t\t\tsplitChunks: {\n\t\t\t\tcacheGroups: {\n\t\t\t\t\tdefaultVendors: {\n\t\t\t\t\t\treuseExistingChunk: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tif (!inBuilding) {\n\t\tconfig['devtool'] = 'source-map';\n\t}\n\telse {\n\t\tconfig['performance'] = {\n\t\t\tmaxEntrypointSize: 450000,\n\t\t\thints: 'warning'\n\t\t};\n\t}\n\n\treturn config;\n};\n\nfunction getEntries() {\n\n\tlet entry: { [key: string]: string[] } = {\n\t\t'main': [process.cwd() + '/src/main.ts']\n\t};\n\n\tif (configuration.vendors) {\n\t\tif (configuration.vendors.js && configuration.vendors.js.length > 0)\n\t\t\tentry.main = entry.main.concat(configuration.vendors.js.map((file: string) => {\n\t\t\t\treturn process.cwd() + (file.endsWith('/') ? '' : '/') + file;\n\t\t\t}));\n\t\tif (configuration.vendors.css && configuration.vendors.css.length > 0)\n\t\t\tentry.main = entry.main.concat(configuration.vendors.css.map((file: string) => {\n\t\t\t\treturn process.cwd() + (file.endsWith('/') ? '' : '/') + file;\n\t\t\t}));\n\t}\n\n\treturn entry;\n}\n\nasync function getPlugins(inBuilding: boolean, env: string) {\n\n\tlet baseHref = options.baseHref ?? configuration.baseHref ?? '/';\n\tif (baseHref === '') baseHref = '/';\n\tlet willUseBaseHref = baseHref !== '' && baseHref !== '/';\n\n\tlet plugins: any[] = [\n\t\tnew CleanWebpackPlugin(),\n\t\tnew HtmlWebpackPlugin({\n\t\t\ttemplate: process.cwd() + '/public/index.html',\n\t\t\tfilename: 'index.html',\n\t\t\tinject: 'body',\n\t\t\tminify: inBuilding ? {\n\t\t\t\tremoveComments: true,\n\t\t\t\tcollapseWhitespace: true,\n\t\t\t\tremoveRedundantAttributes: true,\n\t\t\t\tuseShortDoctype: true,\n\t\t\t\tremoveEmptyAttributes: true,\n\t\t\t\tremoveStyleLinkTypeAttributes: true,\n\t\t\t\tkeepClosingSlash: true,\n\t\t\t\tminifyJS: true,\n\t\t\t\tminifyCSS: true,\n\t\t\t\tminifyURLs: true,\n\t\t\t} : undefined\n\t\t}),\n\t\t// new CopyPlugin({\n\t\t// \tpatterns: [\n\t\t// \t\t{ from: 'public', to: '' }\n\t\t// \t],\n\t\t// \toptions: {\n\t\t// \t  concurrency: 100,\n\t\t// \t},\n\t\t// }),\n\t\tnew MiniCssExtractPlugin({\n\t\t\tfilename: !inBuilding ? '[name].css' : '[name].bundle.[hash].css',\n\t\t\tchunkFilename: !inBuilding ? '[id].css' : '[id].bundle.[hash].css'\n\t\t}),\n\t\tnew webpack.DefinePlugin({\n\t\t\t'process.env': JSON.stringify(await loadEnvFile(env, inBuilding))\n\t\t}),\n\t];\n\n\tif (inBuilding && options.gziped) {\n\t\tplugins.push(new CompressionPlugin({\n\t\t\ttest: /\\.js(\\?.*)?$/i,\n\t\t\talgorithm: 'gzip',\n\t\t\tfilename(info) {\n\t\t\t\tlet opFile = info.path.split('.'),\n\t\t\t\t\topFileType = opFile.pop(),\n\t\t\t\t\topFileName = opFile.join('.');\n\t\t\t\treturn `${opFileName}.${opFileType}.gzip`;\n\t\t\t}\n\t\t}));\n\t}\n\n\tlet preRender = configuration['pre-render'];\n\tlet preRenderRoutes = preRender?.routes ?? [];\n\tlet preRenderEnabled = preRender?.enabled ?? false;\n\tlet willUsePreRender = inBuilding && preRenderEnabled && preRenderRoutes.length > 0;\n\tif (willUsePreRender) {\n\t\tlet routes = (preRender.routes as string[]).map(x => !x.startsWith('/') ? `/${x}` : x);\n\t\tplugins.push(new PrerenderSpaPlugin({\n\t\t\tstaticDir: distPath,\n\t\t\troutes: routes,\n\t\t\trenderer: new Renderer({\n\t\t\t\trenderAfterDocumentEvent: 'render-event',\n\t\t\t\tinjectProperty: 'pre-rendering',\n\t\t\t\tinject: 'true',\n\t\t\t\theadless: true\n\t\t\t}),\n\t\t\tpostProcess: (renderedRoute: any) => {\n\t\t\t\trenderedRoute.route = renderedRoute.originalRoute;\n\t\t\t\trenderedRoute.html = renderedRoute.html.replace('<nimble-root', '<nimble-root style=\"visibility: hidden;\"');\n\t\t\t\trenderedRoute.html = renderedRoute.html.replace(/<style type=\"text\\/css\">(.|\\n)*?<\\/style>/g, '');\n\n\t\t\t\tif (willUseBaseHref) {\n\t\t\t\t\trenderedRoute.html = renderedRoute.html.replace('<base href=\"/\">', `<base href=\"${baseHref}\">`);\n\t\t\t\t}\n\n\t\t\t\treturn renderedRoute;\n\t\t\t}\n\t\t}));\n\t}\n\n\t// if (!willUsePreRender && willUseBaseHref) {\n\t// \tif ('baseHref' in options && !inBuilding) {\n\t// \t\tconsole.log();\n\t// \t\tconsole.log(chalk.yellow('Warning:'), 'the --baseHref argument is not supported on the development server.');\n\t// \t\tplugins.push(new BaseHrefWebpackPlugin({ baseHref: '/' }));\n\t// \t}\n\t// \telse {\n\t// \t\tplugins.push(new BaseHrefWebpackPlugin({ baseHref }));\n\t// \t}\n\t// }\n\t// else {\n\t// \tplugins.push(new BaseHrefWebpackPlugin({ baseHref: '/' }));\n\t// }\n\n\treturn plugins;\n}\n\nfunction getRules(inBuilding: boolean) {\n\tlet rules = [\n\t\t{\n\t\t\ttest: /\\.(ts|js)x?$/,\n\t\t\texclude: /node_modules/,\n\t\t\tloader: 'ts-loader'\n\t\t},\n\t\t{\n\t\t\ttest: /\\.s[ac]ss$/i,\n\t\t\tuse: [\n\t\t\t\t!inBuilding ? 'style-loader' : MiniCssExtractPlugin.loader,\n\t\t\t\t{\n\t\t\t\t\tloader: 'css-loader',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\turl: false,\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tloader: 'sass-loader',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tsourceMap: !inBuilding,\n\t\t\t\t\t\t// minimize: inBuilding\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\ttest: /\\.html$/,\n\t\t\tloader: 'html-loader',\n\t\t\toptions: {\n\t\t\t\t// interpolate: true,\n\t\t\t\t// attrs: [],\n\t\t\t\tsources: false,\n\t\t\t\tminimize: inBuilding\n\t\t\t},\n\t\t},\n\t\t// {\n\t\t// \ttest: /\\.(svg|png|jpg|jpeg)$/,\n\t\t// \tloader: 'file-loader',\n\t\t// \toptions: {\n\t\t// \t\tname: '[name].[ext]',\n\t\t// \t\toutputhPath: 'assets/img/',\n\t\t// \t\tpublicPath: 'assets/img/'\n\t\t// \t}\n\t\t// },\n\t\t// {\n\t\t// \ttest: /\\.(ttf|woff|woff2)$/,\n\t\t// \tloader: 'file-loader',\n\t\t// \toptions: {\n\t\t// \t\tname: '[name].[ext]',\n\t\t// \t\toutputhPath: 'assets/fonts/',\n\t\t// \t\tpublicPath: 'assets/fonts/'\n\t\t// \t}\n\t\t// },\n\t];\n\n\treturn rules;\n}\n\nasync function loadEnvFile(env: string, inBuilding: boolean = false) {\n\tif (env) {\n\t\tvar enviroment = await import(`${process.cwd()}/src/environments/env.${env}.js`);\n\t\tif (enviroment) {\n\t\t\treturn enviroment;\n\t\t}\n\t}\n\treturn {\n\t\tproduction: inBuilding\n\t};\n}"]}