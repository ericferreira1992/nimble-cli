{"version":3,"file":"file-creator.js","sourceRoot":"","sources":["../../../src/core/file-creator/file-creator.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from 'fs-extra';\nimport { FileInstruction } from './file-instruction';\nimport { DirectoryInstruction } from './directory-instruction';\nimport { BaseInstruction } from './base-instruction';\n\nexport class FileCreator {\n    private filesInstruction: (FileInstruction | DirectoryInstruction)[] = [];\n\n    private callbackOnCreateFile?: (reponse: { fileInstruction: FileInstruction | DirectoryInstruction, error?: any }) => void;\n\n    public initialize(filesInstruction: Partial<(FileInstruction | DirectoryInstruction)>[]) {\n        this.filesInstruction = this.prepareFilesInstructions(filesInstruction);\n    }\n\n    public async startCreateFiles(callback?: (reponse: { fileInstruction: FileInstruction | DirectoryInstruction, error?: Error }) => void) {\n        this.callbackOnCreateFile = callback;\n        if (this.filesInstruction.length > 0) {\n            await this.createFilesInstruction(this.filesInstruction);\n        }\n    }\n\n    private prepareFilesInstructions(filesInstruction: Partial<BaseInstruction>[], parent?: DirectoryInstruction) {\n        return filesInstruction.map((x: Partial<BaseInstruction>) => {\n            let instruction = ('content' in x || 'from' in x) ? new FileInstruction(x) : new DirectoryInstruction(x);\n            instruction.parent = parent;\n            \n            if (instruction instanceof DirectoryInstruction)\n                instruction.children = this.prepareFilesInstructions(instruction.children, instruction);\n\n            return instruction;\n        })\n    }\n\n    private async createFilesInstruction(files: BaseInstruction[]) {\n        for (let file of files) {\n            let worksPath = process.cwd(); \n            let filePath = worksPath + '/' + file.completePath();\n            if (file instanceof DirectoryInstruction) {\n                if (!worksPath.endsWith(file.completePath())) {\n                    if (!fs.existsSync(filePath)) {\n                        try {\n                            await fs.mkdir(filePath);\n                        }\n                        catch(e) {\n                            if (this.callbackOnCreateFile)\n                                this.callbackOnCreateFile({ fileInstruction: file, error: e });\n                        }\n                    }\n                }\n                if (file.children && file.children.length > 0)\n                    await this.createFilesInstruction(file.children as BaseInstruction[]);\n            }\n            else if (file instanceof FileInstruction){\n                try {\n                    if (file.content)\n                        await fs.writeFile(filePath, file.content);\n                    else if (file.from)\n                        fs.copyFile(file.from!, filePath)\n\n                    if (this.callbackOnCreateFile)\n                        this.callbackOnCreateFile({ fileInstruction: file });\n                }\n                catch(e) {\n                    if (this.callbackOnCreateFile)\n                        this.callbackOnCreateFile({ fileInstruction: file, error: e });\n                }\n            }\n\n        }\n    }\n}"]}