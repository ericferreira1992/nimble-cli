{"version":3,"file":"webpack-dev-server-utils.js","sourceRoot":"","sources":["../../../src/core/dev-utils/webpack-dev-server-utils.ts"],"names":[],"mappings":"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","sourcesContent":["import address from 'address';\nimport url from 'url';\nimport chalk from 'chalk';\nimport { clearConsole } from '../../core/dev-utils/dev-various-utils';\nimport { formatWebpackMessages } from '../../core/dev-utils/format-webpack-msgs';\n/* import typescriptFormatter from './typescriptFormatter';\nimport forkTsCheckerWebpackPlugin from './ForkTsCheckerWebpackPlugin'; */\n\nconst isInteractive = process.stdout.isTTY;\n\nfunction prepareUrls(protocol, host, port) {\n    const formatUrl = hostname =>\n        url.format({\n            protocol,\n            hostname,\n            port,\n            pathname: '/',\n        });\n    const prettyPrintUrl = hostname =>\n        url.format({\n            protocol,\n            hostname,\n            port: chalk.bold(port),\n            pathname: '/',\n        });\n\n    const isUnspecifiedHost = host === '0.0.0.0' || host === '::';\n    let prettyHost, lanUrlForConfig, lanUrlForTerminal;\n    if (isUnspecifiedHost) {\n        prettyHost = 'localhost';\n        try {\n            lanUrlForConfig = address.ip();\n            if (lanUrlForConfig) {\n                if (\n                    /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n                        lanUrlForConfig\n                    )\n                ) {\n                    lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig);\n                } else {\n                    lanUrlForConfig = undefined;\n                }\n            }\n        } catch (_e) {\n            // ignored\n        }\n    } else {\n        prettyHost = host;\n    }\n    const localUrlForTerminal = prettyPrintUrl(prettyHost);\n    const localUrlForBrowser = formatUrl(prettyHost);\n    return {\n        lanUrlForConfig,\n        lanUrlForTerminal,\n        localUrlForTerminal,\n        localUrlForBrowser,\n    };\n}\n\nfunction createCompiler({ appName, config, urls, webpack }) {\n    // \"Compiler\" is a low-level interface to Webpack.\n    // It lets us listen to some events and provide our own custom messages.\n    let compiler;\n    try {\n        compiler = webpack(config);\n    } catch (err) {\n        console.log(chalk.red('Failed to compile.'));\n        console.log();\n        console.log(err);\n        console.log();\n        process.exit(1);\n    }\n\n    compiler.hooks.invalid.tap('invalid', () => {\n        if (isInteractive) {\n            clearConsole();\n        }\n        console.log('Recompiling...');\n    });\n\n    let isFirstCompile = true;\n    let tsMessagesPromise;\n    let tsMessagesResolver;\n\n    compiler.hooks.beforeCompile.tap('beforeCompile', () => {\n        tsMessagesPromise = new Promise(resolve => {\n            tsMessagesResolver = msgs => resolve(msgs);\n        });\n    });\n\n    // compiler.hooks.done.tap('done', async stats => {\n    compiler.hooks.done.tap('done', (stats) => {\n        const statsData = stats.toJson({\n            all: false,\n            warnings: true,\n            errors: true,\n        });\n\n        const messages = formatWebpackMessages(statsData);\n        const isSuccessful = !messages.errors.length && !messages.warnings.length;\n        if (isSuccessful) {\n            setTimeout(() => {\n\t\t\t\tconsole.log();\n\t\t\t\tconsole.log('✔', chalk.green('Compiled successfully!'));\n\t\t\t\tconsole.log('❯', 'Open the browser at the address:', urls.localUrlForBrowser);\n\t\t\t}, 500);\n        }\n        if (isSuccessful && (isInteractive || isFirstCompile)) {\n        }\n        isFirstCompile = false;\n\n        if (messages.errors.length) {\n            // Only keep the first error. Others are often indicative\n            // of the same problem, but confuse the reader with noise.\n            if (messages.errors.length > 1) {\n                messages.errors.length = 1;\n            }\n            console.log(chalk.red('Failed to compile.\\n'));\n            console.log(messages.errors.join('\\n\\n'));\n            return;\n        }\n\n        // Show warnings if no errors were found.\n        if (messages.warnings.length) {\n            console.log(chalk.yellow('Compiled with warnings.\\n'));\n            console.log(messages.warnings.join('\\n\\n'));\n\n            // Teach some ESLint tricks.\n            console.log(\n                '\\nSearch for the ' +\n                chalk.underline(chalk.yellow('keywords')) +\n                ' to learn more about each warning.'\n            );\n            console.log(\n                'To ignore, add ' +\n                chalk.cyan('// eslint-disable-next-line') +\n                ' to the line before.\\n'\n            );\n\t\t}\n    });\n\n    return compiler;\n}\n\nexport const webpackDevServerUtils = {\n    createCompiler,\n    prepareUrls,\n};"]}